{% extends "base.html" %}

{% block title %}Inicio · Panel de Control{% endblock %}

{% block content %}
<div class="row mb-5">
  <div class="col-12">
    <div class="p-4 p-md-5 rounded-4 bg-white shadow-sm d-flex justify-content-between align-items-center flex-wrap gap-3">
        <div>
            <h1 class="display-6 fw-bold text-primary mb-2">
                {% if user.is_authenticated %}
                    Hola, {{ user.first_name }}
                {% else %}
                    Bienvenida/o al sistema
                {% endif %}
            </h1>
            <p class="lead text-muted mb-0">
                Resumen de actividad y gestión de expedientes.
            </p>
        </div>
        
        {% if user.is_authenticated %}
        <div class="d-flex gap-2">
            <a href="{% url 'casos:lista' %}" class="btn btn-primary btn-lg shadow-sm">
                <i class="bi bi-folder2-open me-2"></i> 
                {% if user.rol == 'estudiante' %}
                    Mis Casos Activos
                {% else %}
                    Total Casos Activos
                {% endif %}
                <span class="badge bg-white text-primary ms-2 rounded-pill">{{ total_casos_activos }}</span>
            </a>
            <a href="{% url 'agenda:calendario' %}" class="btn btn-outline-secondary btn-lg">
                <i class="bi bi-calendar3"></i>
            </a>
        </div>
        {% else %}
            <a href="{% url 'login' %}" class="btn btn-primary btn-lg px-4">Iniciar sesión</a>
        {% endif %}
    </div>
  </div>
</div>

{% if user.is_authenticated %}
<div class="row g-4">
  
  <div class="col-lg-7">
    <div class="card card-modern h-100">
        <div class="card-header-modern d-flex justify-content-between align-items-center">
            <span><i class="bi bi-clock-history me-2"></i>Actividad Reciente</span>
            <span class="badge bg-light text-secondary fw-normal">Documentos</span>
        </div>
        <div class="card-body p-0">
            <div class="list-group list-group-modern list-group-flush">
                {% for doc in docs_recientes %}
                <a href="{{ doc.archivo.url }}" target="_blank" class="list-group-item list-group-item-action d-flex align-items-center gap-3">
                    <div class="rounded p-2 bg-light text-primary">
                        <i class="bi bi-file-earmark-text fs-4"></i>
                    </div>
                    <div class="flex-grow-1">
                        <h6 class="mb-0 fw-semibold">{{ doc.nombre }}</h6>
                        <small class="text-muted">
                            Caso: <span class="fw-medium text-dark">{{ doc.causa.rol_rit }}</span>
                        </small>
                    </div>
                    <div class="text-end">
                        <span class="d-block small fw-bold text-muted">{{ doc.fecha_subida|date:"d M" }}</span>
                        <small class="text-muted" style="font-size: 0.75rem;">{{ doc.fecha_subida|time:"H:i" }}</small>
                    </div>
                </a>
                {% empty %}
                <div class="text-center py-5 text-muted">
                    <i class="bi bi-inbox fs-1 d-block mb-2 opacity-50"></i>
                    No hay documentos recientes.
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
  </div>

  <div class="col-lg-5">
    <div class="card card-modern h-100">
      <div class="card-header-modern d-flex justify-content-between align-items-center">
        <span><i class="bi bi-calendar-day me-2"></i>Agenda de Hoy</span>
        <a href="{% url 'agenda:calendario' %}" class="small text-decoration-none">Ver todo</a>
      </div>
      <div class="card-body p-3">
        {% if citas_hoy %}
            <div class="vstack gap-3">
                {% for cita in citas_hoy %}
                <div class="d-flex p-3 rounded-3 border bg-light align-items-start">
                    <div class="text-center me-3 pe-3 border-end">
                        <span class="d-block fw-bold text-dark h5 mb-0">{{ cita.fecha_hora|time:"H:i" }}</span>
                        <span class="d-block small text-muted text-uppercase">Hrs</span>
                    </div>
                    <div>
                        <h6 class="fw-bold mb-1">{{ cita.get_tipo_display }}</h6>
                        <div class="text-muted small mb-1"><i class="bi bi-geo-alt me-1"></i>{{ cita.lugar }}</div>
                        <span class="badge bg-white border text-secondary rounded-pill">
                            {{ cita.causa.rol_rit }}
                        </span>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="text-center py-5 text-muted">
                <div class="mb-3">
                    <i class="bi bi-calendar-check fs-1 text-success opacity-50"></i>
                </div>
                <h6 class="fw-bold text-dark">Todo despejado</h6>
                <p class="small mb-0">No hay citas programadas para hoy.</p>
            </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endif %}
{% endblock %}