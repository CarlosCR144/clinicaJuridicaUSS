{% extends "base.html" %}

{% block title %}Detalle del caso {{ caso.numero }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="h4 mb-0">Caso {{ caso.numero }}</h2>
  <a href="{% url 'casos:lista' %}" class="btn btn-outline-secondary btn-sm">
    Volver a la lista
  </a>
</div>

<div class="row g-3">
  <div class="col-md-7">
    <div class="card shadow-sm border-0 mb-3">
      <div class="card-header bg-white fw-bold">
        Información general
      </div>
      <div class="card-body">
        <p><strong>Cliente:</strong> {{ caso.cliente }}</p>
        <p><strong>Tipo de caso:</strong> {{ caso.tipo_display }}</p>
        <p><strong>Estado actual:</strong> {{ caso.estado_display }}</p>
        <p><strong>Responsable:</strong> {{ caso.responsable }}</p>
        <p><strong>Descripción:</strong></p>
        <p>{{ caso.descripcion|linebreaks }}</p>
      </div>
    </div>

    <div class="card shadow-sm border-0">
      <div class="card-header bg-white fw-bold">
        Bitácora / comentarios
      </div>
      <div class="card-body">
        {% for comentario in comentarios %}
          <div class="mb-3 pb-3 border-bottom">
            <div class="small text-muted">
              {{ comentario.fecha|date:"d/m/Y H:i" }} · {{ comentario.autor }}
            </div>
            <div>{{ comentario.texto|linebreaks }}</div>
          </div>
        {% empty %}
          <p class="text-muted mb-0">Aún no hay comentarios registrados.</p>
        {% endfor %}
      </div>
    </div>
  </div>

  <div class="col-md-5">
    <div class="card shadow-sm border-0 mb-3">
      <div class="card-header bg-white fw-bold">
        Documentos del caso
      </div>
      <div class="card-body">
        <ul class="list-group list-group-flush">
          {% for doc in documentos %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <span>{{ doc.nombre }}</span>
              <a href="{{ doc.archivo.url }}" class="btn btn-sm btn-outline-primary">Ver</a>
            </li>
          {% empty %}
            <li class="list-group-item text-muted">
              No hay documentos cargados.
            </li>
          {% endfor %}
        </ul>
        <div class="mt-3 text-end">
          <a href="{% url 'documentos:subir' caso.id %}" class="btn btn-sm btn-primary">
            Subir documento
          </a>
        </div>
      </div>
    </div>

    <div class="card shadow-sm border-0">
      <div class="card-header bg-white fw-bold">
        Próximas citas
      </div>
      <div class="card-body">
        {% for cita in citas %}
          <div class="mb-2">
            <div class="fw-semibold">{{ cita.fecha|date:"d/m/Y H:i" }}</div>
            <div class="small text-muted">{{ cita.lugar }}</div>
          </div>
        {% empty %}
          <p class="text-muted mb-0">No hay citas programadas.</p>
        {% endfor %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
