{% extends "base.html" %}

{% block title %}
  {% if form.instance.pk %}Editar Causa{% else %}Nueva Causa{% endif %}
{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-lg-8">
    
    <div class="mb-4">
        <a href="{% url 'casos:lista' %}" class="text-decoration-none text-muted small hover-primary">
            <i class="bi bi-arrow-left me-1"></i> Volver a Casos
        </a>
        <h2 class="h3 fw-bold mt-1">{% if form.instance.pk %}Editar Expediente{% else %}Apertura de Expediente{% endif %}</h2>
    </div>

    <div class="card card-modern">
      <div class="card-body p-4 p-md-5">
        
        <div class="alert alert-primary d-flex align-items-center mb-4 border-0 bg-primary bg-opacity-10 text-primary" role="alert">
          <i class="bi bi-info-circle-fill me-2 fs-5"></i>
          <div>
            <small>Antes de crear la causa, asegúrate de que el <strong>Cliente</strong> esté registrado. <a href="{% url 'personas:crear_cliente' %}" class="fw-bold text-primary">Registrar aquí</a>.</small>
          </div>
        </div>

        <form method="post" novalidate>
          {% csrf_token %}
          
          {% if form.non_field_errors %}
            <div class="alert alert-danger">{{ form.non_field_errors }}</div>
          {% endif %}

          <h6 class="text-uppercase text-muted fw-bold small mb-3 border-bottom pb-2">Datos de Identificación</h6>
          
          <div class="row g-3 mb-4">
            <div class="col-md-4">
              <label class="form-label">RIT / ROL</label>
              {{ form.rol_rit }}
              {% if form.rol_rit.errors %}<div class="text-danger small mt-1">{{ form.rol_rit.errors.0 }}</div>{% endif %}
            </div>
            <div class="col-md-8">
              <label class="form-label">Carátula</label>
              {{ form.caratula }}
              {% if form.caratula.errors %}<div class="text-danger small mt-1">{{ form.caratula.errors.0 }}</div>{% endif %}
            </div>
          </div>

          <h6 class="text-uppercase text-muted fw-bold small mb-3 border-bottom pb-2">Clasificación y Asignación</h6>

          <div class="row g-3 mb-4">
            <div class="col-md-6">
              <label class="form-label">Tribunal</label>
              {{ form.tribunal }}
            </div>
            <div class="col-md-6">
              <label class="form-label">Materia</label>
              {{ form.materia }}
            </div>
            <div class="col-md-6">
              <label class="form-label">Cliente Principal</label>
              {{ form.cliente }}
            </div>
            <div class="col-md-6">
              <label class="form-label">Estudiante Responsable</label>
              {{ form.responsable }}
              <div class="form-text small">Dejar vacío para auto-asignar.</div>
            </div>
          </div>

          <div class="mb-4">
              <label class="form-label">Descripción de los Hechos</label>
              {{ form.descripcion }}
          </div>

          <hr class="my-4">

          <div class="d-flex justify-content-end gap-2">
            <a href="{% url 'casos:lista' %}" class="btn btn-light border text-muted">Cancelar</a>
            <button type="submit" class="btn btn-primary px-4">Guardar Expediente</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}